<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>Coffee Shop — Live Orders Dashboard</title>
  <script src="https://cdn.tailwindcss.com"></script>
  <style>
    /* Small tweaks beyond Tailwind for nicer cards */
    .scrollbar-thin::-webkit-scrollbar { height: 8px; width: 8px }
    .scrollbar-thin::-webkit-scrollbar-thumb { background: rgba(0,0,0,0.15); border-radius: 9999px }
    .status-waiting { background: linear-gradient(90deg,#fef3c7,#fde68a); }
    .status-progress { background: linear-gradient(90deg,#bfdbfe,#93c5fd); }
    .status-ready { background: linear-gradient(90deg,#bbf7d0,#86efac); }
    .muted { color: rgba(0,0,0,0.55) }
  </style>
</head>
<body class="bg-gray-50 text-gray-900 min-h-screen">
  <div class="max-w-7xl mx-auto p-4">
    <header class="flex items-start justify-between gap-4 mb-4">
      <div>
        <h1 class="text-2xl font-semibold">☕ Coffee Shop — Live Orders</h1>
        <p class="text-sm text-gray-600 mt-1">Manager dashboard — track orders, update statuses, and spot problems.</p>
      </div>

      <div class="flex items-center gap-3">
        <div class="bg-white p-2 rounded shadow flex items-center gap-2">
          <label class="text-sm text-gray-600">Auto-refresh</label>
          <select id="autoRefreshSelect" class="border rounded px-2 py-1 text-sm">
            <option value="0">Off</option>
            <option value="5">5s</option>
            <option value="10">10s</option>
            <option value="30">30s</option>
            <option value="60">60s</option>
          </select>
        </div>

        <button id="addDemoBtn" class="bg-amber-500 hover:bg-amber-600 text-white px-3 py-2 rounded shadow">Add Demo Order</button>
        <button id="addManyBtn" class="bg-white border px-3 py-2 rounded shadow text-sm">Add 5 Demo Orders</button>
      </div>
    </header>

    <main class="grid grid-cols-1 lg:grid-cols-4 gap-4">
      <!-- Left: Summary + Alerts + Assistant -->
      <section class="lg:col-span-1 space-y-4">
        <div class="bg-white rounded-2xl shadow p-4">
          <h2 class="font-semibold text-lg">Summary</h2>
          <div id="summaryBar" class="mt-3 grid grid-cols-3 gap-3 text-sm">
            <!-- populated by JS -->
          </div>
          <div class="mt-3 text-xs text-gray-600">Revenue numbers are for demo/day scope (resets when page reloads).</div>
        </div>

        <div class="bg-white rounded-2xl shadow p-4">
          <h2 class="font-semibold text-lg">Alerts</h2>
          <div id="alertsPanel" class="mt-3 space-y-2 max-h-48 overflow-auto scrollbar-thin">
            <!-- alert items -->
          </div>
        </div>

        <div class="bg-white rounded-2xl shadow p-4">
          <h2 class="font-semibold text-lg">Smart Assistant</h2>
          <div id="assistantPanel" class="mt-3 text-sm space-y-2">
            <!-- suggestions -->
          </div>
        </div>

        <div class="bg-white rounded-2xl shadow p-4 text-sm">
          <h3 class="font-medium">Controls</h3>
          <div class="mt-2 space-y-2">
            <button id="clearAllBtn" class="w-full bg-red-50 text-red-600 border border-red-100 px-3 py-2 rounded">Clear all demo orders</button>
            <button id="resetRevenueBtn" class="w-full bg-white border px-3 py-2 rounded">Reset Revenue</button>
          </div>
        </div>
      </section>

      <!-- Right: Orders grid (spans 3 cols) -->
      <section class="lg:col-span-3">
        <div class="bg-white rounded-2xl shadow p-4 mb-4 flex items-center justify-between">
          <div>
            <h2 class="font-semibold text-lg">Orders</h2>
            <p class="text-sm text-gray-600">Card view of live orders — click status buttons to update.</p>
          </div>
          <div class="text-sm text-gray-600">Total: <span id="ordersCount">0</span></div>
        </div>

        <div id="ordersGrid" class="grid grid-cols-1 sm:grid-cols-2 xl:grid-cols-3 gap-4">
          <!-- order cards inserted here -->
        </div>
      </section>
    </main>
  </div>

  <template id="orderCardTpl">
    <div class="bg-white rounded-2xl p-4 shadow relative">
      <div class="flex items-start justify-between gap-3">
        <div>
          <div class="text-lg font-semibold customer-name">Customer</div>
          <div class="text-xs muted mt-1 customer-meta">Table 1 • Card</div>
        </div>
        <div class="text-right">
          <div class="text-sm timestamp muted">Just now</div>
          <div class="text-xs muted mt-1 order-id"></div>
        </div>
      </div>

      <div class="mt-3 text-sm order-items max-h-28 overflow-auto scrollbar-thin"></div>

      <div class="mt-4 flex items-center justify-between gap-3">
        <div class="flex items-center gap-2">
          <div class="px-2 py-1 rounded-full text-xs font-medium status-pill">WAITING</div>
          <div class="text-sm muted payment-method">Cash</div>
        </div>

        <div class="flex items-center gap-2">
          <button class="btn-status-waiting px-2 py-1 text-xs rounded border">Waiting</button>
          <button class="btn-status-progress px-2 py-1 text-xs rounded border">In progress</button>
          <button class="btn-status-ready px-2 py-1 text-xs rounded border">Ready</button>
          <button class="btn-cancel ml-2 px-2 py-1 text-xs rounded bg-red-50 text-red-600 border">Cancel</button>
        </div>
      </div>

      <div class="mt-3 flex items-center justify-between text-xs muted">
        <div class="order-meta">Items: <span class="item-count">0</span></div>
        <div class="order-total">₹ <span class="total-amt">0.00</span></div>
      </div>

      <div class="absolute top-3 left-3 opacity-0 priority-badge px-2 py-0.5 rounded text-xs font-semibold"></div>
    </div>
  </template>

  <script>
    // ---- Simple in-memory model ----
    const ORDERS = [];
    let revenue = 0;

    // Demo catalog
    const DRINKS = [
      { name: 'Caffe Latte', price: 220 },
      { name: 'Cappuccino', price: 200 },
      { name: 'Americano', price: 150 },
      { name: 'Flat White', price: 210 },
      { name: 'Iced Cold Brew', price: 240 },
      { name: 'Mocha', price: 230 }
    ];
    const PASTRIES = [
      { name: 'Croissant', price: 80 },
      { name: 'Almond Croissant', price: 110 },
      { name: 'Blueberry Muffin', price: 90 },
      { name: 'Chocolate Brownie', price: 120 }
    ];
    const SNACKS = [
      { name: 'Ham Sandwich', price: 180 },
      { name: 'Veg Wrap', price: 160 },
      { name: 'Quiche', price: 150 }
    ];

    const PAYMENT = ['Cash','Card','UPI','Employee'];

    // Utilities
    function fmtTime(ts) {
      const d = new Date(ts);
      return d.toLocaleTimeString([], {hour: '2-digit', minute:'2-digit'});
    }
    function minutesSince(ts) {
      return Math.floor((Date.now() - ts)/60000);
    }

    // DOM refs
    const ordersGrid = document.getElementById('ordersGrid');
    const orderTpl = document.getElementById('orderCardTpl');
    const summaryBar = document.getElementById('summaryBar');
    const alertsPanel = document.getElementById('alertsPanel');
    const assistantPanel = document.getElementById('assistantPanel');
    const addDemoBtn = document.getElementById('addDemoBtn');
    const addManyBtn = document.getElementById('addManyBtn');
    const autoRefreshSelect = document.getElementById('autoRefreshSelect');
    const ordersCount = document.getElementById('ordersCount');
    const clearAllBtn = document.getElementById('clearAllBtn');
    const resetRevenueBtn = document.getElementById('resetRevenueBtn');

    // Auto-refresh timer
    let refreshTimer = null;

    function createOrder({ customer, items, payment, timestamp, status='waiting', id=null }){
      const order = {
        id: id || 'ORD' + Math.floor(Math.random()*90000+10000),
        customer: customer || fakerName(),
        items: items || [],
        payment: payment || PAYMENT[Math.floor(Math.random()*PAYMENT.length)],
        timestamp: timestamp || Date.now(),
        status: status,
        canceled: false
      };
      order.total = order.items.reduce((s,i)=>s + (i.price||0), 0);
      ORDERS.unshift(order);
      revenue += order.total;
      renderAll();
      return order;
    }

    function fakerName(){
      const names = ['Asha','Ravi','Neha','Karan','Maya','Sameer','Priya','Arjun','Sana','Vikram'];
      return names[Math.floor(Math.random()*names.length)];
    }

    function randomOrder(){
      const itemCount = Math.floor(Math.random()*4)+1; // 1-4
      const items = [];
      for(let i=0;i<itemCount;i++){
        const cat = Math.random();
        if(cat < 0.55) items.push(randomFrom(DRINKS));
        else if(cat < 0.85) items.push(randomFrom(PASTRIES));
        else items.push(randomFrom(SNACKS));
      }
      // possibly make a group order (more items)
      if(Math.random() < 0.08){
        const extra = Math.floor(Math.random()*5)+3; // +3..7
        for(let i=0;i<extra;i++) items.push(randomFrom(DRINKS));
      }
      return { customer: fakerName(), items, payment: randomFrom(PAYMENT) };
    }
    function randomFrom(arr){
      const idx = Math.floor(Math.random()*arr.length);
      // clone so we can mutate counts/prices
      return Object.assign({}, arr[idx]);
    }

    // Render functions
    function renderAll(){
      renderOrders();
      renderSummary();
      renderAlerts();
      renderAssistant();
    }

    function renderOrders(){
      ordersGrid.innerHTML = '';
      let activeCount = 0;
      ORDERS.forEach(order => {
        const node = document.importNode(orderTpl.content, true);
        const root = node.querySelector('div');
        root.dataset.orderId = order.id;

        const customerName = node.querySelector('.customer-name');
        customerName.textContent = order.customer;

        const meta = node.querySelector('.customer-meta');
        meta.textContent = `${order.items.length} items • ${order.payment}`;

        const ts = node.querySelector('.timestamp');
        ts.textContent = fmtTime(order.timestamp) + ' • ' + minutesSince(order.timestamp) + 'm ago';

        node.querySelector('.order-id').textContent = order.id;

        const itemsEl = node.querySelector('.order-items');
        itemsEl.innerHTML = order.items.map(it => `<div class="flex justify-between"><div>${it.name}</div><div>₹ ${it.price.toFixed(0)}</div></div>`).join('');

        node.querySelector('.item-count').textContent = order.items.length;
        node.querySelector('.total-amt').textContent = order.total.toFixed(2);

        const statusPill = node.querySelector('.status-pill');
        updateStatusVisual(statusPill, root, order.status);

        // priority badge for large orders or long-waiting
        const badge = node.querySelector('.priority-badge');
        const mins = minutesSince(order.timestamp);
        if(order.items.length >= 8) { badge.textContent = 'GROUP'; badge.style.background = '#fde68a'; badge.style.opacity = 1; }
        else if(mins >= 10 && !order.canceled && order.status !== 'ready') { badge.textContent = 'LONG'; badge.style.background = '#fecaca'; badge.style.opacity = 1; }

        // Buttons
        node.querySelector('.btn-status-waiting').addEventListener('click', ()=> updateOrderStatus(order.id,'waiting'));
        node.querySelector('.btn-status-progress').addEventListener('click', ()=> updateOrderStatus(order.id,'inprogress'));
        node.querySelector('.btn-status-ready').addEventListener('click', ()=> updateOrderStatus(order.id,'ready'));
        node.querySelector('.btn-cancel').addEventListener('click', ()=> cancelOrder(order.id));

        if(order.canceled){
          root.classList.add('opacity-60');
        }

        ordersGrid.appendChild(node);
        if(!order.canceled) activeCount++;
      });
      ordersCount.textContent = ORDERS.length;
    }

    function updateStatusVisual(pillEl, cardEl, status){
      pillEl.textContent = status === 'waiting' ? 'WAITING' : status === 'inprogress' ? 'IN PROGRESS' : 'READY';
      pillEl.className = 'px-2 py-1 rounded-full text-xs font-medium status-pill';
      cardEl.classList.remove('status-waiting','status-progress','status-ready');
      if(status === 'waiting') { pillEl.classList.add('bg-amber-100','text-amber-800'); cardEl.classList.add('status-waiting'); }
      if(status === 'inprogress') { pillEl.classList.add('bg-blue-100','text-blue-800'); cardEl.classList.add('status-progress'); }
      if(status === 'ready') { pillEl.classList.add('bg-green-100','text-green-800'); cardEl.classList.add('status-ready'); }
    }

    function updateOrderStatus(id, status){
      const o = ORDERS.find(x=>x.id===id);
      if(!o) return;
      if(o.canceled) return alert('Order already canceled');
      o.status = status;
      if(status === 'ready'){
        // ready — possibly remove from queue or keep with ready
      }
      renderAll();
    }

    function cancelOrder(id){
      const idx = ORDERS.findIndex(x=>x.id===id);
      if(idx === -1) return;
      const o = ORDERS[idx];
      if(o.canceled) return;
      o.canceled = true;
      // subtract revenue (manager may want that)
      revenue -= o.total;
      renderAll();
    }

    function renderSummary(){
      const total = ORDERS.length;
      const ready = ORDERS.filter(o=>o.status==='ready' && !o.canceled).length;
      const pending = ORDERS.filter(o=>o.status!=='ready' && !o.canceled).length;
      summaryBar.innerHTML = `
        <div class="bg-amber-50 rounded-lg p-3 text-center">
          <div class="text-xs text-gray-600">Total</div>
          <div class="text-lg font-semibold">${total}</div>
        </div>
        <div class="bg-white rounded-lg p-3 text-center border">
          <div class="text-xs text-gray-600">Ready</div>
          <div class="text-lg font-semibold text-green-600">${ready}</div>
        </div>
        <div class="bg-white rounded-lg p-3 text-center border">
          <div class="text-xs text-gray-600">Pending</div>
          <div class="text-lg font-semibold text-blue-600">${pending}</div>
        </div>
      `;

      // revenue row below
      const revRow = document.createElement('div');
      revRow.className = 'mt-3 text-sm';
      revRow.innerHTML = `<div class="text-xs text-gray-600">Revenue (today)</div><div class="text-xl font-semibold">₹ ${revenue.toFixed(2)}</div>`;
      if(summaryBar.nextSibling) summaryBar.parentElement.querySelectorAll('.revRow').forEach(n=>n.remove());
      revRow.classList.add('revRow');
      summaryBar.parentElement.appendChild(revRow);
    }

    function renderAlerts(){
      alertsPanel.innerHTML = '';
      const alerts = [];
      // long waiting (>10m)
      ORDERS.forEach(o=>{
        if(!o.canceled && o.status !== 'ready'){
          const mins = minutesSince(o.timestamp);
          if(mins >= 10) alerts.push({ type:'long-wait', msg:`Order ${o.id} by ${o.customer} waiting ${mins}m` });
        }
        if(o.items.length >= 8) alerts.push({ type:'group', msg:`Large order ${o.id} — ${o.items.length} items` });
        if(o.canceled) alerts.push({ type:'cancel', msg:`Order ${o.id} canceled — ${o.customer}` });
      });

      if(alerts.length === 0){
        const n = document.createElement('div'); n.className = 'text-sm text-gray-600'; n.textContent = 'No alerts'; alertsPanel.appendChild(n);
      } else {
        alerts.forEach(a=>{
          const el = document.createElement('div');
          el.className = 'p-2 rounded border text-sm';
          if(a.type==='long-wait') el.classList.add('bg-red-50','border-red-100','text-red-700');
          if(a.type==='group') el.classList.add('bg-amber-50','border-amber-100','text-amber-700');
          if(a.type==='cancel') el.classList.add('bg-gray-50','border-gray-100','text-gray-700');
          el.textContent = a.msg;
          alertsPanel.appendChild(el);
        });
      }
    }

    function renderAssistant(){
      assistantPanel.innerHTML = '';
      // Suggestion 1: trending pastry counts
      const pastryCounts = {};
      ORDERS.forEach(o=> o.items.forEach(it=>{ if(PASTRIES.some(p=>p.name===it.name)) pastryCounts[it.name] = (pastryCounts[it.name]||0)+1; }));
      const sortedPas = Object.entries(pastryCounts).sort((a,b)=>b[1]-a[1]);
      if(sortedPas.length){
        const [name,count] = sortedPas[0];
        if(count >= 3) {
          const s = document.createElement('div'); s.className = 'p-2 rounded border border-amber-100 bg-amber-50'; s.textContent = `Consider prepping more ${name}s — ${count} orders in queue.`; assistantPanel.appendChild(s);
        }
      }

      // Suggestion 2: long waiting count
      const longCount = ORDERS.filter(o=> !o.canceled && o.status!=='ready' && minutesSince(o.timestamp) >= 7).length;
      if(longCount > 0){
        const s = document.createElement('div'); s.className = 'p-2 rounded border border-red-100 bg-red-50'; s.textContent = `${longCount} order(s) approaching long wait — consider reallocating staff.`; assistantPanel.appendChild(s);
      }

      // Suggestion 3: big group orders
      const groupCount = ORDERS.filter(o=> o.items.length >= 8 && !o.canceled).length;
      if(groupCount > 0){
        const s = document.createElement('div'); s.className = 'p-2 rounded border border-amber-100 bg-amber-50'; s.textContent = `${groupCount} large group order(s) — consider batching.`; assistantPanel.appendChild(s);
      }

      if(assistantPanel.children.length === 0){
        const n = document.createElement('div'); n.className = 'text-sm text-gray-600'; n.textContent = 'No suggestions right now — good job!'; assistantPanel.appendChild(n);
      }
    }

    // Demo actions
    addDemoBtn.addEventListener('click', ()=>{
      const seed = randomOrder();
      createOrder(seed);
    });
    addManyBtn.addEventListener('click', ()=>{
      for(let i=0;i<5;i++) createOrder(randomOrder());
    });

    clearAllBtn.addEventListener('click', ()=>{
      if(!confirm('Clear all demo orders? This cannot be undone.')) return;
      ORDERS.length = 0; revenue = 0; renderAll();
    });

    resetRevenueBtn.addEventListener('click', ()=>{ revenue = 0; renderSummary(); });

    // Auto-refresh logic (simulate progress of waiting -> inprogress -> ready randomly)
    autoRefreshSelect.addEventListener('change', ()=>{
      const val = Number(autoRefreshSelect.value);
      setAutoRefresh(val);
    });

    function setAutoRefresh(seconds){
      if(refreshTimer) clearInterval(refreshTimer);
      if(!seconds) return;
      refreshTimer = setInterval(()=>{
        simulateProgress();
      }, seconds*1000);
    }

    function simulateProgress(){
      // randomly advance some waiting orders to inprogress, and some inprogress to ready
      const waiting = ORDERS.filter(o=>o.status==='waiting' && !o.canceled);
      const inprog = ORDERS.filter(o=>o.status==='inprogress' && !o.canceled);
      if(waiting.length){
        const pick = waiting[Math.floor(Math.random()*waiting.length)];
        if(Math.random() < 0.45) pick.status = 'inprogress';
      }
      if(inprog.length){
        const pick = inprog[Math.floor(Math.random()*inprog.length)];
        if(Math.random() < 0.35) pick.status = 'ready';
      }
      // also mark some very old waiting orders as long-wait alerts by not changing
      renderAll();
    }

    // initial state
    (function seed(){
      // add a few demo orders with timestamps offset to show timers
      const now = Date.now();
      const o1 = createOrder({ ...randomOrder(), timestamp: now - (2*60000) }); // 2m ago
      const o2 = createOrder({ ...randomOrder(), timestamp: now - (12*60000) }); // 12m ago
      const o3 = createOrder({ ...randomOrder(), timestamp: now - (6*60000) });
      // make o2 inprogress
      ORDERS[1].status = 'inprogress';
      renderAll();
    })();

    // small keyboard shortcut: press D to add demo order
    window.addEventListener('keydown', (e)=>{
      if(e.key.toLowerCase() === 'd') createOrder(randomOrder());
    });

    // Expose methods (for debugging if needed)
    window._ORDERS = ORDERS;
    window._getSnapshot = ()=> ({ orders: ORDERS.slice(), revenue });

    // ensure UI knows default auto-refresh from select
    setAutoRefresh(Number(autoRefreshSelect.value));
  </script>
</body>
</html>
